{% extends "base.html" %}

{% block title %}ç›‘æ§è®¾ç½® - {{ super() }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">ç›‘æ§è®¾ç½®</h1>
    <span class="text-muted">æ¬¢è¿, {{ session.username }}!</span>
</div>


{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category or 'success' }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="post" class="needs-validation" novalidate>
    <!-- Card 1: åŸºç¡€é…ç½® -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16"><path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311a1.464 1.464 0 0 1-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413-1.4-2.397 0-2.81l.34-.1a1.464 1.464 0 0 1 .872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/></svg> åŸºç¡€é…ç½®</h4>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="monitor_urls" class="form-label"><strong>ç›‘æ§ç½‘å€</strong></label>
                <textarea class="form-control" id="monitor_urls" name="monitor_urls" rows="4" required>{{ config.monitor_urls }}</textarea>
                <div class="form-text">æ¯è¡Œä¸€ä¸ªæˆ–ç”¨è‹±æ–‡é€—å·åˆ†éš”å¤šä¸ªURLã€‚</div>
                 <div class="invalid-feedback">è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªç›‘æ§ç½‘å€ã€‚</div>
            </div>
            <div class="mb-3">
                <label for="monitor_interval_seconds" class="form-label"><strong>ç›‘æ§é—´éš” (ç§’)</strong></label>
                <input type="number" class="form-control" id="monitor_interval_seconds" name="monitor_interval_seconds" value="{{ config.monitor_interval_seconds }}" required>
            </div>
        </div>
    </div>

    <!-- Card 2: é€šçŸ¥æ¸ é“ (ä½¿ç”¨ Accordion) -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bell-fill" viewBox="0 0 16 16"><path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"/></svg> é€šçŸ¥æ¸ é“</h4>
        </div>
        <div class="accordion" id="notificationAccordion">
            <!-- Telegram è®¾ç½® -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTelegram">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTelegram" aria-expanded="false" aria-controls="collapseTelegram">
                        <strong>âœˆï¸ Telegram é€šçŸ¥</strong>
                    </button>
                </h2>
                <div id="collapseTelegram" class="accordion-collapse collapse" aria-labelledby="headingTelegram" data-bs-parent="#notificationAccordion">
                    <div class="accordion-body">
                        <div class="mb-3">
                            <label for="telegram_bot_token" class="form-label">Bot Token</label>
                            <input type="text" class="form-control" id="telegram_bot_token" name="telegram_bot_token" value="{{ config.telegram_bot_token }}">
                        </div>
                        <div class="mb-3">
                            <label for="telegram_chat_id" class="form-label">Chat ID</label>
                            <input type="text" class="form-control" id="telegram_chat_id" name="telegram_chat_id" value="{{ config.telegram_chat_id }}">
                        </div>
                    </div>
                </div>
            </div>
            <!-- SMTP é‚®ä»¶è®¾ç½® -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingSmtp">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSmtp" aria-expanded="false" aria-controls="collapseSmtp">
                        <strong>ğŸ“§ é‚®ä»¶é€šçŸ¥ (SMTP)</strong>
                    </button>
                </h2>
                <div id="collapseSmtp" class="accordion-collapse collapse" aria-labelledby="headingSmtp" data-bs-parent="#notificationAccordion">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="smtp_host" class="form-label">SMTP ä¸»æœº</label>
                                <input type="text" class="form-control" id="smtp_host" name="smtp_host" value="{{ config.smtp_host }}">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="smtp_port" class="form-label">ç«¯å£</label>
                                <input type="number" class="form-control" id="smtp_port" name="smtp_port" value="{{ config.smtp_port }}">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="smtp_user" class="form-label">ç”¨æˆ·å</label>
                            <input type="text" class="form-control" id="smtp_user" name="smtp_user" value="{{ config.smtp_user }}">
                        </div>
                        <div class="mb-3">
                            <label for="smtp_password" class="form-label">å¯†ç æˆ–æˆæƒç </label>
                            <input type="password" class="form-control" id="smtp_password" name="smtp_password" value="{{ config.smtp_password }}">
                        </div>
                         <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="smtp_from" class="form-label">å‘ä»¶äººåœ°å€</label>
                                <input type="email" class="form-control" id="smtp_from" name="smtp_from" value="{{ config.smtp_from }}">
                                <div class="form-text">å¯ç•™ç©ºï¼Œé»˜è®¤ä¸ºç”¨æˆ·åã€‚</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="to_email" class="form-label">æ”¶ä»¶äººåœ°å€</label>
                                <input type="email" class="form-control" id="to_email" name="to_email" value="{{ config.to_email }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Card 3: é«˜çº§è®¾ç½® -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h4><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16"><path d="M1 0L0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.617-2.654A3.003 3.003 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l2.914 2.915a.5.5 0 0 1-.707.707l-2.915-2.914a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445-.445-.287-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"/></svg> é«˜çº§è®¾ç½®</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="screenshot_width" class="form-label">æˆªå›¾å®½åº¦ (px)</label>
                    <input type="number" class="form-control" id="screenshot_width" name="screenshot_width" value="{{ config.screenshot_width }}">
                </div>
                <div class="col-md-4 mb-3">
                    <label for="screenshot_max_height" class="form-label">æœ€å¤§é¡µé¢é«˜åº¦ (px)</label>
                    <inp
